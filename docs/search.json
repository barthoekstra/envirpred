[{"path":"index.html","id":"introduction","chapter":"Introduction","heading":"Introduction","text":"","code":""},{"path":"index.html","id":"reproducible-analysis","chapter":"Introduction","heading":"0.1 Reproducible analysis","text":"entire analysis contained book can reproduced running following function bookdown package.may necessary install additional packages make use bs4_book template book.","code":"\nbookdown::render_book(\"index.Rmd\")\ninstall.packages(\"remotes\")\nremotes::install_github(\"rstudio/bslib\")\ninstall.packages(\"downlit\")"},{"path":"gee-harmonic-regression.html","id":"gee-harmonic-regression","chapter":"1 GEE: Harmonic Regression","heading":"1 GEE: Harmonic Regression","text":"project want explore degree environmental predictability can explain species declines among sub-Saharan migrant songbirds. define environmental predictability degree simple harmonic regression model can fit seasonal changes environmental variables wintering areas sub-Saharan migrants.able run harmonic time series analysis fine-scale across full extent wintering ranges birds, use Google Earth Engine (GEE).","code":""},{"path":"gee-harmonic-regression.html","id":"processing-environment","chapter":"1 GEE: Harmonic Regression","heading":"1.1 Processing environment","text":"","code":"\nlibrary(rgee)\nlibrary(sf)\nlibrary(leaflet)\nee_Initialize(drive = TRUE)## ── rgee 1.0.6 ─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── earthengine-api 0.1.240 ── \n##  ✓ email: not_defined\n##  ✓ Google Drive credentials:\n ✓ Google Drive credentials:  FOUND\n##  ✓ Initializing Google Earth Engine:\n ✓ Initializing Google Earth Engine:  DONE!\n## \n ✓ Earth Engine user: users/barthoekstra \n## ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────"},{"path":"gee-harmonic-regression.html","id":"apply-harmonic-regression-to-gee-datasets","chapter":"1 GEE: Harmonic Regression","heading":"1.2 Apply harmonic regression to GEE datasets","text":"function R/rgee_harmonic_regression.R contains code necessary run harmonic regression GEE using rgee package. export harmonic regression results 10km resolution limit spatial domain following area.Obviously area spans much just Africa, interpretation results (possible future expansion analysis include breeding areas), beneficial.can now run harmonic regression GEE generate GeoTIFFs analyses. particularly interested NDVI use temporal range NASA/GIMMS/3GV0 dataset (GEE) determine time frame run analysis.","code":"\naoi <- read_sf(\"data/raw/studyarea.geojson\")\nleaflet(aoi) %>%\n  addProviderTiles(\"CartoDB.Positron\") %>%\n  addPolygons(color = \"black\")\nsource(\"R/rgee_harmonic_regression.R\")\n\nres <- 10000\n\nndvi1 <- rgee_harmonic_regression(dataset = \"NASA/GIMMS/3GV0\", dependent = \"ndvi\", harmonics = 1, \n                                  aoi = aoi, resolution = res, dsn = \"data/raw/gee/ndvi_1.tif\", mask = -1)\nndvi2 <- rgee_harmonic_regression(dataset = \"NASA/GIMMS/3GV0\", dependent = \"ndvi\", harmonics = 2,\n                                  aoi = aoi, resolution = res, dsn = \"data/raw/gee/ndvi_2.tif\", mask = -1)\naet1 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"aet\", harmonics = 1,\n                                 aoi = aoi, resolution = res, dsn = \"data/gee/raw/aet_1.tif\")\naet2 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"aet\", harmonics = 2,\n                                 aoi = aoi, resolution = res, dsn = \"data/gee/raw/aet_2.tif\")\npr1 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"pr\", harmonics = 1,\n                                aoi = aoi, resolution = res, dsn = \"data/gee/raw/pr_1.tif\")\npr2 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"pr\", harmonics = 2,\n                                aoi = aoi, resolution = res, dsn = \"data/gee/raw/pr_2.tif\")\ntmmn1 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"tmmn\", harmonics = 1,\n                                  aoi = aoi, resolution = res, dsn = \"data/gee/raw/tmmn_1.tif\")\ntmmn2 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"tmmn\", harmonics = 2,\n                                  aoi = aoi, resolution = res, dsn = \"data/gee/raw/tmmn_2.tif\")\ntmmx1 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"tmmx\", harmonics = 1,\n                                  aoi = aoi, resolution = res, dsn = \"data/gee/raw/tmmx_1.tif\")\ntmmx2 <- rgee_harmonic_regression(dataset = \"IDAHO_EPSCOR/TERRACLIMATE\", dependent = \"tmmx\", harmonics = 2,\n                                  aoi = aoi, resolution = res, dsn = \"data/gee/raw/tmmx_2.tif\")"},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"preprocess-bird-trends-and-distribution-maps","chapter":"2 Preprocess bird trends and distribution maps","heading":"2 Preprocess bird trends and distribution maps","text":"","code":""},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"converting-the-esri-geodatabase","chapter":"2 Preprocess bird trends and distribution maps","heading":"2.1 Converting the ESRI Geodatabase","text":"use BirdLife species distribution maps1 determine extents analyses. data provided ESRI File Geodatabase somehow difficult query due size, convert Geopackage first. file substantially bigger, much quicker query.","code":"\nogr2ogr(\"data/raw/birdlife/BOTW.gdb\", \"data/raw/birdlife/BOTW.gpkg\", f = \"GPKG\", nlt = \"MULTIPOLYGON\", sql = \"SELECT * FROM All_Species\", progress = TRUE)"},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"load-species-trends","chapter":"2 Preprocess bird trends and distribution maps","heading":"2.2 Load species trends","text":"use species trends derived PECBMS, Pan-European Common Bird Monitoring Scheme, contains trends 179 European breeding birds.","code":"\ncolnames_species <- c(\"euring\", \"species\", \"namenote\", \"trend_long\", \"trend_short\", \"trend_long_slope\",\n                      \"trend_long_se\", \"trend_short_slope\", \"trend_short_se\", \"habitat\", \"common_name\",\n                      \"trend_classification\", \"graphnote\")\ncoltypes_species <- \"ncnnnnnnncccc\"\n\nspecies <- read_delim(\"data/raw/pecbms/pecbms-europe-indicesandtrends-2019.csv\", delim = \";\", \n                      col_names = colnames_species, col_types = coltypes_species, skip = 1)\nhead(species)"},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"loading-species-traits","chapter":"2 Preprocess bird trends and distribution maps","heading":"2.3 Loading species traits","text":"download dataset life-history characteristics (LHC) Storchová & Hořák.2We can now load dataset extract species name migratory characteristics, can filter latter later.add species trends life-history characteristics single dataframe.can inspect species migration strategy found yet mismatching species name-pairs. species NA values family column.can now manually change scientific names life-history characteristics dataset match PECBMS dataset.join LHC PECBMS datasets.","code":"\nif (!file.exists(\"data/raw/life-history-characteristics/Life-history characteristics of European birds.txt\")) {\n  paths_cache <- dryad_download(\"10.5061/dryad.n6k3n\")[[1]]\n  paths_final <- paste0(\"data/raw/life-history-characteristics/\", basename(paths_cache))\n  \n  if(!dir.exists(\"data/raw/life-history-characteristics\")) {\n    dir.create(\"data/raw/life-history-characteristics\")\n  }\n  file.copy(from = paths_cache, to = paths_final)\n  file.remove(paths_cache)\n}\nlhc <- read_tsv(\"data/raw/life-history-characteristics/Life-history characteristics of European birds.txt\",\n                col_types = cols_only(`Species` = col_character(), `Family` = col_character(),\n                                      `Sedentary` = col_double(), `Facultative migrant` = col_double(),\n                                      `Short distance migrant` = col_double(), `Long distance migrant` = col_double())) %>%\n  rename(species = Species, family = Family, sedentary = Sedentary, facultative = `Facultative migrant`, \n         shortdist = `Short distance migrant`, longdist = `Long distance migrant`) %>%\n  drop_na()\nspecies %>%\n  left_join(lhc, by = c(\"species\" = \"species\")) -> species\nspecies %>%\n  filter(is.na(family)) %>%\n  head()\nname_replacements <-\n  c(\"Ptyonoprogne rupestris\" = \"Hirundo rupestris\",\n    \"Cecropis daurica\" = \"Hirundo daurica\",\n    \"Cyanecula svecica\" = \"Luscinia svecica\",\n    \"Oenanthe pleschanka\" = \"Oenanthe cypriaca\",\n    \"Iduna pallida\" = \"Hippolais pallida\",\n    \"Sylvia melanothorax\" = \"Sylvia melanothorax\",  # Not in LHC dataset\n    \"Poecile palustris\" = \"Parus palustris\",\n    \"Poecile montanus\" = \"Parus montanus\",\n    \"Lophophanes cristatus\" = \"Parus cristatus\",\n    \"Periparus ater\" = \"Parus ater\",\n    \"Cyanistes caeruleus\" = \"Parus caeruleus\",\n    \"Chloris chloris\" = \"Carduelis chloris\",\n    \"Spinus spinus\" = \"Carduelis spinus\",\n    \"Linaria cannabina\" = \"Carduelis cannabina\",\n    \"Acanthis flammea\" = \"Carduelis flammea\",\n    \"Emberiza calandra\" = \"Miliaria calandra\"\n    )\nspeciesnames <- lhc$species\noldnames <- speciesnames\nfor (name in names(name_replacements)) {\n  speciesnames <- replace(speciesnames, which(speciesnames == name), name_replacements[name])\n}\nlhc$species <- speciesnames\nspecies %>%\n  dplyr::select(-colnames(lhc)[!colnames(lhc) %in% c(\"species\")]) %>%\n  left_join(lhc, by = c(\"species\" = \"species\")) %>%\n  drop_na(family) %>%\n  identity() -> species\n\nhead(species)"},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"select-migratory-species","chapter":"2 Preprocess bird trends and distribution maps","heading":"2.4 Select migratory species","text":"now dataset 169 species, merely interested actually migratory, filter resident facultative migrants.","code":"\nspecies %>%\n  filter(sedentary != 1 & facultative != 1) -> species\n\nhead(species)"},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"match-names-to-birdlife-taxonomy","chapter":"2 Preprocess bird trends and distribution maps","heading":"2.5 Match names to BirdLife taxonomy","text":"Finally, querying BirdLife distribution maps, match scientific names taxonomy used BirdLife., see species matched tweak manually match BirdLife dataset.tweak species manually.","code":"\nbirdlife_taxonomy <- readxl::read_excel(\"data/raw/birdlife/HBW-BirdLife_List_of_Birds_v4.xlsx\", \n                                        col_names = c(\"family_birdlife\", \"common_name_birdlife\", \"species\", \"iucn_redlist\"))\n\nspecies %>%\n  left_join(birdlife_taxonomy, by = c(\"species\" = \"species\")) -> species\nspecies %>%\n  filter(is.na(family_birdlife)) %>%\n  head()\nname_replacements_birdlife <-\n  c(\"Hirundo daurica\" = \"Cecropis daurica\",\n    \"Luscinia svecica\" = \"Cyanecula svecica\",\n    \"Hippolais pallida\" = \"Iduna pallida\",\n    \"Carduelis spinus\" = \"Spinus spinus\",\n    \"Carduelis flammea\" = \"Acanthis flammea\"\n    )\nspeciesnames <- species$species\noldnames <- speciesnames\nfor (name in names(name_replacements_birdlife)) {\n  speciesnames <- replace(speciesnames, which(speciesnames == name), name_replacements_birdlife[name])\n}\nspecies$species_birdlife <- speciesnames"},{"path":"preprocess-bird-trends-and-distribution-maps.html","id":"querying-distribution-maps","chapter":"2 Preprocess bird trends and distribution maps","heading":"2.6 Querying distribution maps","text":"Now gathered species trends selected migratory species, can query database select corresponding distribution maps. species distributed massive areas, select parts distributions intersect bounding box Africa.can now join datasets save upcoming analysis steps.","code":"\nspecies_query <- str_sub(str_replace_all(toString(paste0(\"SCINAME = '\", species$species_birdlife, \"' OR \")), \" OR , \", \" OR \"),\n                         start = 1, end = -5)\nquery <- paste(\"SELECT * FROM All_Species WHERE (\", species_query, \") AND PRESENCE = 1 AND SEASONAL = 3\", sep = \"\")\n\nafrica <- st_read(\"data/raw/Africa.gpkg\")\n\nogr2ogr(\"data/raw/birdlife/BOTW.gpkg\", \"data/processed/TrendSpecies.gpkg\", sql = query, f = \"GPKG\", nlt = \"MULTIPOLYGON\", progress = TRUE,\n        spat = st_bbox(africa))\nst_read(\"data/processed/TrendSpecies.gpkg\") %>%\n  group_by(SCINAME) %>%\n  summarise(species = SCINAME, geometry = st_union(st_buffer(geom, dist = 0))) %>%\n  distinct(species) %>%\n  left_join(species, by = c(\"species\" = \"species\")) %>%\n  identity() -> trendspecies\n\nsaveRDS(trendspecies, file = \"data/processed/trendspecies.RDS\")"},{"path":"references.html","id":"references","chapter":"3 References","heading":"3 References","text":"1. Bird species distribution maps world. Version 2019.1 (2019).2. Storchová, L., Hořák, D. (2018). Life-history characteristics european birds. Global Ecology Biogeography 27, 400–406.","code":""}]
