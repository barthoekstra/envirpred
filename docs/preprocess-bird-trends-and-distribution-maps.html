<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2 Preprocess bird trends and distribution maps | Environmental predictability &amp; Population trends</title>
<meta name="author" content="Bart Hoekstra">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Linking environmental predictability to assemblage population trends of Afro-Palearctic migrants">Environmental predictability &amp; Population trends</a>:
        <small class="text-muted">Linking environmental predictability to assemblage population trends of Afro-Palearctic migrants</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Introduction</a></li>
<li class="book-part">Data Preparation</li>
<li><a class="" href="gee-harmonic-regression.html"><span class="header-section-number">1</span> GEE: Harmonic Regression</a></li>
<li><a class="active" href="preprocess-bird-trends-and-distribution-maps.html"><span class="header-section-number">2</span> Preprocess bird trends and distribution maps</a></li>
<li><a class="" href="species-assemblage-trends.html"><span class="header-section-number">3</span> Species assemblage trends</a></li>
<li><a class="" href="ecoregions-biomes.html"><span class="header-section-number">4</span> Ecoregions &amp; Biomes</a></li>
<li><a class="" href="environmental-predictability-trends.html"><span class="header-section-number">5</span> Environmental predictability &amp; trends</a></li>
<li class="book-part">Analysis: Global model</li>
<li><a class="" href="model-assemblage-trends.html"><span class="header-section-number">6</span> Model assemblage trends</a></li>
<li><a class="" href="quantify-model-uncertainty.html"><span class="header-section-number">7</span> Quantify model uncertainty</a></li>
<li class="book-part">Analysis: Local model</li>
<li><a class="" href="model-local-assemblage-trends.html"><span class="header-section-number">8</span> Model local assemblage trends</a></li>
<li class="book-part">Figures</li>
<li><a class="" href="environmental-variables.html"><span class="header-section-number">9</span> Environmental variables</a></li>
<li class="book-part">Other</li>
<li><a class="" href="references.html"><span class="header-section-number">10</span> References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/barthoekstra/envirpred">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="preprocess-bird-trends-and-distribution-maps" class="section level1">
<h1>
<span class="header-section-number">2</span> Preprocess bird trends and distribution maps<a class="anchor" aria-label="anchor" href="#preprocess-bird-trends-and-distribution-maps"><i class="fas fa-link"></i></a>
</h1>
<div id="converting-the-esri-geodatabase" class="section level2">
<h2>
<span class="header-section-number">2.1</span> Converting the ESRI Geodatabase<a class="anchor" aria-label="anchor" href="#converting-the-esri-geodatabase"><i class="fas fa-link"></i></a>
</h2>
<p>We use the <a href="http://datazone.birdlife.org/species/requestdis">BirdLife species distribution maps</a><span class="citation"><sup><a href="references.html#ref-birdlife2019" role="doc-biblioref">1</a></sup></span> to determine the extents of our analyses. As this data is provided in an ESRI File Geodatabase that is somehow difficult to query due to its size, we convert it to a Geopackage first. The file will be substantially bigger, but much quicker to query.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ogr2ogr</span><span class="op">(</span><span class="st">"data/raw/birdlife/BOTW.gdb"</span>, <span class="st">"data/raw/birdlife/BOTW.gpkg"</span>, f <span class="op">=</span> <span class="st">"GPKG"</span>, nlt <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span>, sql <span class="op">=</span> <span class="st">"SELECT * FROM All_Species"</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-species-trends" class="section level2">
<h2>
<span class="header-section-number">2.2</span> Load species trends<a class="anchor" aria-label="anchor" href="#load-species-trends"><i class="fas fa-link"></i></a>
</h2>
<p>We will use species trends derived from <a href="https://pecbms.info/trends-and-indicators/species-trends/">PECBMS</a>, the Pan-European Common Bird Monitoring Scheme, which contains trends for 170 European breeding birds.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">colnames_species</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"euring"</span>, <span class="st">"species"</span>, <span class="st">"namenote"</span>, <span class="st">"trend_long"</span>, <span class="st">"trend_short"</span>, <span class="st">"trend_long_slope"</span>,
                      <span class="st">"trend_long_se"</span>, <span class="st">"trend_short_slope"</span>, <span class="st">"trend_short_se"</span>, <span class="st">"habitat"</span>, <span class="st">"common_name"</span>,
                      <span class="st">"trend_classification"</span>, <span class="st">"graphnote"</span><span class="op">)</span>
<span class="va">coltypes_species</span> <span class="op">&lt;-</span> <span class="st">"ncnnnnnnncccc"</span>

<span class="va">species</span> <span class="op">&lt;-</span> <span class="fu">read_delim</span><span class="op">(</span><span class="st">"data/raw/pecbms/pecbms-europe-indicesandtrends-2019.csv"</span>, delim <span class="op">=</span> <span class="st">";"</span>, 
                      col_names <span class="op">=</span> <span class="va">colnames_species</span>, col_types <span class="op">=</span> <span class="va">coltypes_species</span>, skip <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="3%">
<col width="11%">
<col width="4%">
<col width="5%">
<col width="6%">
<col width="8%">
<col width="7%">
<col width="9%">
<col width="7%">
<col width="4%">
<col width="10%">
<col width="15%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="right">euring</th>
<th align="left">species</th>
<th align="right">namenote</th>
<th align="right">trend_long</th>
<th align="right">trend_short</th>
<th align="right">trend_long_slope</th>
<th align="right">trend_long_se</th>
<th align="right">trend_short_slope</th>
<th align="right">trend_short_se</th>
<th align="left">habitat</th>
<th align="left">common_name</th>
<th align="left">trend_classification</th>
<th align="left">graphnote</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">70</td>
<td align="left">Tachybaptus ruficollis</td>
<td align="right">7</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Little Grebe</td>
<td align="left">Stable</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">90</td>
<td align="left">Podiceps cristatus</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">-1</td>
<td align="right">0.99</td>
<td align="right">0.00</td>
<td align="right">1.01</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Great Crested Grebe</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1110</td>
<td align="left">Bubulcus ibis</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">67</td>
<td align="right">1.01</td>
<td align="right">0.01</td>
<td align="right">1.07</td>
<td align="right">0.01</td>
<td align="left">farmland</td>
<td align="left">Cattle Egret</td>
<td align="left">Stable</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1190</td>
<td align="left">Egretta garzetta</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">14</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Little Egret</td>
<td align="left">Moderate increase (p&lt;0.05) *</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">1220</td>
<td align="left">Ardea cinerea</td>
<td align="right">NA</td>
<td align="right">118</td>
<td align="right">-19</td>
<td align="right">1.02</td>
<td align="right">0.00</td>
<td align="right">0.99</td>
<td align="right">0.00</td>
<td align="left">other</td>
<td align="left">Grey Heron</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">1340</td>
<td align="left">Ciconia ciconia</td>
<td align="right">NA</td>
<td align="right">57</td>
<td align="right">-1</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="left">farmland</td>
<td align="left">White Stork</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="loading-species-traits" class="section level2">
<h2>
<span class="header-section-number">2.3</span> Loading species traits<a class="anchor" aria-label="anchor" href="#loading-species-traits"><i class="fas fa-link"></i></a>
</h2>
<p>We download a dataset of life-history characteristics (LHC) by Storchová &amp; Hořák.<span class="citation"><sup><a href="references.html#ref-storchova2018" role="doc-biblioref">2</a></sup></span></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html">file.exists</a></span><span class="op">(</span><span class="st">"data/raw/life-history-characteristics/Life-history characteristics of European birds.txt"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">paths_cache</span> <span class="op">&lt;-</span> <span class="fu">dryad_download</span><span class="op">(</span><span class="st">"10.5061/dryad.n6k3n"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>
  <span class="va">paths_final</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"data/raw/life-history-characteristics/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/basename.html">basename</a></span><span class="op">(</span><span class="va">paths_cache</span><span class="op">)</span><span class="op">)</span>
  
  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.exists</a></span><span class="op">(</span><span class="st">"data/raw/life-history-characteristics"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/files2.html">dir.create</a></span><span class="op">(</span><span class="st">"data/raw/life-history-characteristics"</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span><span class="op">(</span>from <span class="op">=</span> <span class="va">paths_cache</span>, to <span class="op">=</span> <span class="va">paths_final</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/files.html">file.remove</a></span><span class="op">(</span><span class="va">paths_cache</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can now load the dataset and extract species name and migratory characteristics, so we can filter for the latter later.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lhc</span> <span class="op">&lt;-</span> <span class="fu">read_tsv</span><span class="op">(</span><span class="st">"data/raw/life-history-characteristics/Life-history characteristics of European birds.txt"</span>,
                col_types <span class="op">=</span> <span class="fu">cols_only</span><span class="op">(</span>`Species` <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>, `Family` <span class="op">=</span> <span class="fu">col_character</span><span class="op">(</span><span class="op">)</span>,
                                      `Sedentary` <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>, `Facultative migrant` <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>,
                                      `Short distance migrant` <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span>, `Long distance migrant` <span class="op">=</span> <span class="fu">col_double</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>species <span class="op">=</span> <span class="va">Species</span>, family <span class="op">=</span> <span class="va">Family</span>, sedentary <span class="op">=</span> <span class="va">Sedentary</span>, facultative <span class="op">=</span> <span class="va">`Facultative migrant`</span>, 
         shortdist <span class="op">=</span> <span class="va">`Short distance migrant`</span>, longdist <span class="op">=</span> <span class="va">`Long distance migrant`</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>We add the species trends and life-history characteristics to a single dataframe.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">lhc</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">species</span></code></pre></div>
<p>We can inspect for which species no migration strategy has been found yet because of mismatching species name-pairs. These are species which have <code>NA</code> values for the <code>family</code> column.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">family</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="2%">
<col width="6%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="5%">
<col width="4%">
<col width="5%">
<col width="4%">
<col width="2%">
<col width="8%">
<col width="9%">
<col width="25%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="3%">
<col width="2%">
</colgroup>
<thead><tr class="header">
<th align="right">euring</th>
<th align="left">species</th>
<th align="right">namenote</th>
<th align="right">trend_long</th>
<th align="right">trend_short</th>
<th align="right">trend_long_slope</th>
<th align="right">trend_long_se</th>
<th align="right">trend_short_slope</th>
<th align="right">trend_short_se</th>
<th align="left">habitat</th>
<th align="left">common_name</th>
<th align="left">trend_classification</th>
<th align="left">graphnote</th>
<th align="left">family</th>
<th align="right">sedentary</th>
<th align="right">facultative</th>
<th align="right">shortdist</th>
<th align="right">longdist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">9910</td>
<td align="left">Hirundo rupestris</td>
<td align="right">10</td>
<td align="right">45</td>
<td align="right">22</td>
<td align="right">1.01</td>
<td align="right">0.01</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Eurasian Crag-martin</td>
<td align="left">Stable</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">9950</td>
<td align="left">Hirundo daurica</td>
<td align="right">10</td>
<td align="right">108</td>
<td align="right">54</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Red-rumped Swallow</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">11060</td>
<td align="left">Luscinia svecica</td>
<td align="right">9</td>
<td align="right">-33</td>
<td align="right">-18</td>
<td align="right">0.98</td>
<td align="right">0.01</td>
<td align="right">0.99</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Bluethroat</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">Index only represents population change of subspecies Luscinia svecica svecica.</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">11471</td>
<td align="left">Oenanthe cypriaca</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">-3</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.00</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Cyprus Wheatear</td>
<td align="left">Stable</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="right">12550</td>
<td align="left">Hippolais pallida</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">94</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.04</td>
<td align="right">0.03</td>
<td align="left">other</td>
<td align="left">Eastern Olivaceous Warbler</td>
<td align="left">Uncertain</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="right">12680</td>
<td align="left">Sylvia melanothorax</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">25</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.06</td>
<td align="right">0.02</td>
<td align="left">other</td>
<td align="left">Cyprus Warbler</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">NA</td>
</tr>
</tbody>
</table></div>
</div>
<p>We can now manually change the scientific names in the life-history characteristics dataset to match with the PECBMS dataset.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_replacements</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Ptyonoprogne rupestris"</span> <span class="op">=</span> <span class="st">"Hirundo rupestris"</span>,
    <span class="st">"Cecropis daurica"</span> <span class="op">=</span> <span class="st">"Hirundo daurica"</span>,
    <span class="st">"Cyanecula svecica"</span> <span class="op">=</span> <span class="st">"Luscinia svecica"</span>,
    <span class="st">"Oenanthe pleschanka"</span> <span class="op">=</span> <span class="st">"Oenanthe cypriaca"</span>,
    <span class="st">"Iduna pallida"</span> <span class="op">=</span> <span class="st">"Hippolais pallida"</span>,
    <span class="st">"Sylvia melanothorax"</span> <span class="op">=</span> <span class="st">"Sylvia melanothorax"</span>,  <span class="co"># Not in LHC dataset</span>
    <span class="st">"Poecile palustris"</span> <span class="op">=</span> <span class="st">"Parus palustris"</span>,
    <span class="st">"Poecile montanus"</span> <span class="op">=</span> <span class="st">"Parus montanus"</span>,
    <span class="st">"Lophophanes cristatus"</span> <span class="op">=</span> <span class="st">"Parus cristatus"</span>,
    <span class="st">"Periparus ater"</span> <span class="op">=</span> <span class="st">"Parus ater"</span>,
    <span class="st">"Cyanistes caeruleus"</span> <span class="op">=</span> <span class="st">"Parus caeruleus"</span>,
    <span class="st">"Chloris chloris"</span> <span class="op">=</span> <span class="st">"Carduelis chloris"</span>,
    <span class="st">"Spinus spinus"</span> <span class="op">=</span> <span class="st">"Carduelis spinus"</span>,
    <span class="st">"Linaria cannabina"</span> <span class="op">=</span> <span class="st">"Carduelis cannabina"</span>,
    <span class="st">"Acanthis flammea"</span> <span class="op">=</span> <span class="st">"Carduelis flammea"</span>,
    <span class="st">"Emberiza calandra"</span> <span class="op">=</span> <span class="st">"Miliaria calandra"</span>
    <span class="op">)</span>
<span class="va">speciesnames</span> <span class="op">&lt;-</span> <span class="va">lhc</span><span class="op">$</span><span class="va">species</span>
<span class="va">oldnames</span> <span class="op">&lt;-</span> <span class="va">speciesnames</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">name_replacements</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">speciesnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">speciesnames</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">speciesnames</span> <span class="op">==</span> <span class="va">name</span><span class="op">)</span>, <span class="va">name_replacements</span><span class="op">[</span><span class="va">name</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">lhc</span><span class="op">$</span><span class="va">species</span> <span class="op">&lt;-</span> <span class="va">speciesnames</span></code></pre></div>
<p>And we once again join the LHC and PECBMS datasets.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">lhc</span><span class="op">)</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">lhc</span><span class="op">)</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">lhc</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">drop_na</span><span class="op">(</span><span class="va">family</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/identity.html">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">species</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="2%">
<col width="9%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="6%">
<col width="5%">
<col width="7%">
<col width="5%">
<col width="3%">
<col width="7%">
<col width="11%">
<col width="3%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="right">euring</th>
<th align="left">species</th>
<th align="right">namenote</th>
<th align="right">trend_long</th>
<th align="right">trend_short</th>
<th align="right">trend_long_slope</th>
<th align="right">trend_long_se</th>
<th align="right">trend_short_slope</th>
<th align="right">trend_short_se</th>
<th align="left">habitat</th>
<th align="left">common_name</th>
<th align="left">trend_classification</th>
<th align="left">graphnote</th>
<th align="left">family</th>
<th align="right">sedentary</th>
<th align="right">facultative</th>
<th align="right">shortdist</th>
<th align="right">longdist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">70</td>
<td align="left">Tachybaptus ruficollis</td>
<td align="right">7</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Little Grebe</td>
<td align="left">Stable</td>
<td align="left">NA</td>
<td align="left">Podicipedidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">90</td>
<td align="left">Podiceps cristatus</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">-1</td>
<td align="right">0.99</td>
<td align="right">0.00</td>
<td align="right">1.01</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Great Crested Grebe</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Podicipedidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1110</td>
<td align="left">Bubulcus ibis</td>
<td align="right">10</td>
<td align="right">15</td>
<td align="right">67</td>
<td align="right">1.01</td>
<td align="right">0.01</td>
<td align="right">1.07</td>
<td align="right">0.01</td>
<td align="left">farmland</td>
<td align="left">Cattle Egret</td>
<td align="left">Stable</td>
<td align="left">NA</td>
<td align="left">Ardeidae</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1190</td>
<td align="left">Egretta garzetta</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">14</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Little Egret</td>
<td align="left">Moderate increase (p&lt;0.05) *</td>
<td align="left">NA</td>
<td align="left">Ardeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1220</td>
<td align="left">Ardea cinerea</td>
<td align="right">NA</td>
<td align="right">118</td>
<td align="right">-19</td>
<td align="right">1.02</td>
<td align="right">0.00</td>
<td align="right">0.99</td>
<td align="right">0.00</td>
<td align="left">other</td>
<td align="left">Grey Heron</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Ardeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1340</td>
<td align="left">Ciconia ciconia</td>
<td align="right">NA</td>
<td align="right">57</td>
<td align="right">-1</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="left">farmland</td>
<td align="left">White Stork</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Ciconiidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="select-migratory-species" class="section level2">
<h2>
<span class="header-section-number">2.4</span> Select migratory species<a class="anchor" aria-label="anchor" href="#select-migratory-species"><i class="fas fa-link"></i></a>
</h2>
<p>We now have a dataset of 169 species, but we are merely interested in those that are actually migratory, so we filter out resident and facultative migrants.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">sedentary</span> <span class="op">!=</span> <span class="fl">1</span> <span class="op">&amp;</span> <span class="va">facultative</span> <span class="op">!=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">species</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">species</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<colgroup>
<col width="2%">
<col width="9%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="6%">
<col width="5%">
<col width="7%">
<col width="5%">
<col width="3%">
<col width="7%">
<col width="11%">
<col width="3%">
<col width="5%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="right">euring</th>
<th align="left">species</th>
<th align="right">namenote</th>
<th align="right">trend_long</th>
<th align="right">trend_short</th>
<th align="right">trend_long_slope</th>
<th align="right">trend_long_se</th>
<th align="right">trend_short_slope</th>
<th align="right">trend_short_se</th>
<th align="left">habitat</th>
<th align="left">common_name</th>
<th align="left">trend_classification</th>
<th align="left">graphnote</th>
<th align="left">family</th>
<th align="right">sedentary</th>
<th align="right">facultative</th>
<th align="right">shortdist</th>
<th align="right">longdist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">70</td>
<td align="left">Tachybaptus ruficollis</td>
<td align="right">7</td>
<td align="right">12</td>
<td align="right">2</td>
<td align="right">1.01</td>
<td align="right">0</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Little Grebe</td>
<td align="left">Stable</td>
<td align="left">NA</td>
<td align="left">Podicipedidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">90</td>
<td align="left">Podiceps cristatus</td>
<td align="right">7</td>
<td align="right">5</td>
<td align="right">-1</td>
<td align="right">0.99</td>
<td align="right">0</td>
<td align="right">1.01</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Great Crested Grebe</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Podicipedidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1190</td>
<td align="left">Egretta garzetta</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">14</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Little Egret</td>
<td align="left">Moderate increase (p&lt;0.05) *</td>
<td align="left">NA</td>
<td align="left">Ardeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1220</td>
<td align="left">Ardea cinerea</td>
<td align="right">NA</td>
<td align="right">118</td>
<td align="right">-19</td>
<td align="right">1.02</td>
<td align="right">0</td>
<td align="right">0.99</td>
<td align="right">0.00</td>
<td align="left">other</td>
<td align="left">Grey Heron</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Ardeidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1340</td>
<td align="left">Ciconia ciconia</td>
<td align="right">NA</td>
<td align="right">57</td>
<td align="right">-1</td>
<td align="right">1.01</td>
<td align="right">0</td>
<td align="right">1.01</td>
<td align="right">0.00</td>
<td align="left">farmland</td>
<td align="left">White Stork</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Ciconiidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1730</td>
<td align="left">Tadorna tadorna</td>
<td align="right">8</td>
<td align="right">27</td>
<td align="right">-5</td>
<td align="right">1.01</td>
<td align="right">0</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="left">other</td>
<td align="left">Common Shelduck</td>
<td align="left">Moderate increase (p&lt;0.05) *</td>
<td align="left">NA</td>
<td align="left">Anatidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table></div>
</div>
</div>
<div id="match-names-to-birdlife-taxonomy" class="section level2">
<h2>
<span class="header-section-number">2.5</span> Match names to BirdLife taxonomy<a class="anchor" aria-label="anchor" href="#match-names-to-birdlife-taxonomy"><i class="fas fa-link"></i></a>
</h2>
<p>Finally, we will be querying BirdLife distribution maps, so we have to match scientific names with the taxonomy used by BirdLife.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">birdlife_taxonomy</span> <span class="op">&lt;-</span> <span class="fu">readxl</span><span class="fu">::</span><span class="fu"><a href="https://readxl.tidyverse.org/reference/read_excel.html">read_excel</a></span><span class="op">(</span><span class="st">"data/raw/birdlife/HBW-BirdLife_List_of_Birds_v4.xlsx"</span>, 
                                        col_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"family_birdlife"</span>, <span class="st">"common_name_birdlife"</span>, <span class="st">"species"</span>, <span class="st">"iucn_redlist"</span><span class="op">)</span><span class="op">)</span>

<span class="va">species</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">birdlife_taxonomy</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">species</span></code></pre></div>
<p>Once again, we see which species are not matched and tweak these manually to match with the BirdLife dataset.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">family_birdlife</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table style="width:100%;" class="table table-sm">
<colgroup>
<col width="1%">
<col width="4%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="4%">
<col width="4%">
<col width="2%">
<col width="7%">
<col width="8%">
<col width="21%">
<col width="4%">
<col width="2%">
<col width="3%">
<col width="2%">
<col width="2%">
<col width="4%">
<col width="5%">
<col width="3%">
</colgroup>
<thead><tr class="header">
<th align="right">euring</th>
<th align="left">species</th>
<th align="right">namenote</th>
<th align="right">trend_long</th>
<th align="right">trend_short</th>
<th align="right">trend_long_slope</th>
<th align="right">trend_long_se</th>
<th align="right">trend_short_slope</th>
<th align="right">trend_short_se</th>
<th align="left">habitat</th>
<th align="left">common_name</th>
<th align="left">trend_classification</th>
<th align="left">graphnote</th>
<th align="left">family</th>
<th align="right">sedentary</th>
<th align="right">facultative</th>
<th align="right">shortdist</th>
<th align="right">longdist</th>
<th align="left">family_birdlife</th>
<th align="left">common_name_birdlife</th>
<th align="left">iucn_redlist</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">9950</td>
<td align="left">Hirundo daurica</td>
<td align="right">10</td>
<td align="right">108</td>
<td align="right">54</td>
<td align="right">1.02</td>
<td align="right">0.01</td>
<td align="right">1.05</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Red-rumped Swallow</td>
<td align="left">Moderate increase (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Hirundinidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">11060</td>
<td align="left">Luscinia svecica</td>
<td align="right">9</td>
<td align="right">-33</td>
<td align="right">-18</td>
<td align="right">0.98</td>
<td align="right">0.01</td>
<td align="right">0.99</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Bluethroat</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">Index only represents population change of subspecies Luscinia svecica svecica.</td>
<td align="left">Muscicapidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">12550</td>
<td align="left">Hippolais pallida</td>
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">94</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="right">1.04</td>
<td align="right">0.03</td>
<td align="left">other</td>
<td align="left">Eastern Olivaceous Warbler</td>
<td align="left">Uncertain</td>
<td align="left">NA</td>
<td align="left">Acrocephalidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">16540</td>
<td align="left">Carduelis spinus</td>
<td align="right">NA</td>
<td align="right">12</td>
<td align="right">29</td>
<td align="right">0.99</td>
<td align="right">0.00</td>
<td align="right">1.00</td>
<td align="right">0.00</td>
<td align="left">forest</td>
<td align="left">Eurasian Siskin</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Fringillidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">16630</td>
<td align="left">Carduelis flammea</td>
<td align="right">NA</td>
<td align="right">-75</td>
<td align="right">47</td>
<td align="right">0.97</td>
<td align="right">0.00</td>
<td align="right">1.03</td>
<td align="right">0.01</td>
<td align="left">other</td>
<td align="left">Common Redpoll</td>
<td align="left">Moderate decline (p&lt;0.01) **</td>
<td align="left">NA</td>
<td align="left">Fringillidae</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
</tbody>
</table></div>
</div>
<p>And we tweak those species manually.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_replacements_birdlife</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Hirundo daurica"</span> <span class="op">=</span> <span class="st">"Cecropis daurica"</span>,
    <span class="st">"Luscinia svecica"</span> <span class="op">=</span> <span class="st">"Cyanecula svecica"</span>,
    <span class="st">"Hippolais pallida"</span> <span class="op">=</span> <span class="st">"Iduna pallida"</span>,
    <span class="st">"Carduelis spinus"</span> <span class="op">=</span> <span class="st">"Spinus spinus"</span>,
    <span class="st">"Carduelis flammea"</span> <span class="op">=</span> <span class="st">"Acanthis flammea"</span>
    <span class="op">)</span>
<span class="va">speciesnames</span> <span class="op">&lt;-</span> <span class="va">species</span><span class="op">$</span><span class="va">species</span>
<span class="va">oldnames</span> <span class="op">&lt;-</span> <span class="va">speciesnames</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">name</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">name_replacements_birdlife</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">speciesnames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/replace.html">replace</a></span><span class="op">(</span><span class="va">speciesnames</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">speciesnames</span> <span class="op">==</span> <span class="va">name</span><span class="op">)</span>, <span class="va">name_replacements_birdlife</span><span class="op">[</span><span class="va">name</span><span class="op">]</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">species</span><span class="op">$</span><span class="va">species_birdlife</span> <span class="op">&lt;-</span> <span class="va">speciesnames</span></code></pre></div>
</div>
<div id="querying-distribution-maps" class="section level2">
<h2>
<span class="header-section-number">2.6</span> Querying distribution maps<a class="anchor" aria-label="anchor" href="#querying-distribution-maps"><i class="fas fa-link"></i></a>
</h2>
<p>Now that we have gathered the species trends and selected only migratory species, we can query the database to select the corresponding distribution maps. As some species are distributed over massive areas, we select only these parts of their distributions that intersect with the bounding box of Africa.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">species_query</span> <span class="op">&lt;-</span> <span class="fu">str_sub</span><span class="op">(</span><span class="fu">str_replace_all</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/toString.html">toString</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"SCINAME = '"</span>, <span class="va">species</span><span class="op">$</span><span class="va">species_birdlife</span>, <span class="st">"' OR "</span><span class="op">)</span><span class="op">)</span>, <span class="st">" OR , "</span>, <span class="st">" OR "</span><span class="op">)</span>,
                         start <span class="op">=</span> <span class="fl">1</span>, end <span class="op">=</span> <span class="op">-</span><span class="fl">5</span><span class="op">)</span>
<span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"SELECT * FROM All_Species WHERE ("</span>, <span class="va">species_query</span>, <span class="st">") AND PRESENCE = 1 AND SEASONAL = 3"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">africa</span> <span class="op">&lt;-</span> <span class="fu">st_read</span><span class="op">(</span><span class="st">"data/raw/Africa.gpkg"</span><span class="op">)</span>

<span class="fu">ogr2ogr</span><span class="op">(</span><span class="st">"data/raw/birdlife/BOTW.gpkg"</span>, <span class="st">"data/processed/TrendSpecies.gpkg"</span>, sql <span class="op">=</span> <span class="va">query</span>, f <span class="op">=</span> <span class="st">"GPKG"</span>, nlt <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span>, progress <span class="op">=</span> <span class="cn">TRUE</span>,
        spat <span class="op">=</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="va">africa</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can now join these datasets again and save them for upcoming analysis steps.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">st_read</span><span class="op">(</span><span class="st">"data/processed/TrendSpecies.gpkg"</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">group_by</span><span class="op">(</span><span class="va">SCINAME</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">summarise</span><span class="op">(</span>species <span class="op">=</span> <span class="va">SCINAME</span>, geometry <span class="op">=</span> <span class="fu">st_union</span><span class="op">(</span><span class="fu">st_buffer</span><span class="op">(</span><span class="va">geom</span>, dist <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct</span><span class="op">(</span><span class="va">species</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">left_join</span><span class="op">(</span><span class="va">species</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/identity.html">identity</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">trendspecies</span>

<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">trendspecies</span>, file <span class="op">=</span> <span class="st">"data/processed/trendspecies.RDS"</span><span class="op">)</span></code></pre></div>
</div>
<div id="species-included-in-the-analysis" class="section level2">
<h2>
<span class="header-section-number">2.7</span> Species included in the analysis<a class="anchor" aria-label="anchor" href="#species-included-in-the-analysis"><i class="fas fa-link"></i></a>
</h2>
<p>Finally the following species have now been included in this analysis, based on their distribution ranges and migratory behavior.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/processed/trendspecies.RDS"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">st_drop_geometry</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">ungroup</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">common_name_birdlife</span>, <span class="va">trend_long</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">rename</span><span class="op">(</span>`Scientific name` <span class="op">=</span> <span class="va">species</span>, 
         `Common name (BirdLife)` <span class="op">=</span> <span class="va">common_name_birdlife</span>,
         `Long-term trend` <span class="op">=</span> <span class="va">trend_long</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">species_included</span>

<span class="va">species_included</span></code></pre></div>
<div class="kable-table">
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Scientific name</th>
<th align="left">Common name (BirdLife)</th>
<th align="right">Long-term trend</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Accipiter nisus</td>
<td align="left">Eurasian Sparrowhawk</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Acrocephalus arundinaceus</td>
<td align="left">Great Reed-warbler</td>
<td align="right">-3</td>
</tr>
<tr class="odd">
<td align="left">Acrocephalus palustris</td>
<td align="left">Marsh Warbler</td>
<td align="right">-9</td>
</tr>
<tr class="even">
<td align="left">Acrocephalus schoenobaenus</td>
<td align="left">Sedge Warbler</td>
<td align="right">-29</td>
</tr>
<tr class="odd">
<td align="left">Acrocephalus scirpaceus</td>
<td align="left">Common Reed-warbler</td>
<td align="right">-4</td>
</tr>
<tr class="even">
<td align="left">Actitis hypoleucos</td>
<td align="left">Common Sandpiper</td>
<td align="right">-36</td>
</tr>
<tr class="odd">
<td align="left">Anas platyrhynchos</td>
<td align="left">Mallard</td>
<td align="right">49</td>
</tr>
<tr class="even">
<td align="left">Anthus campestris</td>
<td align="left">Tawny Pipit</td>
<td align="right">-67</td>
</tr>
<tr class="odd">
<td align="left">Anthus pratensis</td>
<td align="left">Meadow Pipit</td>
<td align="right">-62</td>
</tr>
<tr class="even">
<td align="left">Anthus trivialis</td>
<td align="left">Tree Pipit</td>
<td align="right">-52</td>
</tr>
<tr class="odd">
<td align="left">Apus apus</td>
<td align="left">Common Swift</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">Ardea cinerea</td>
<td align="left">Grey Heron</td>
<td align="right">118</td>
</tr>
<tr class="odd">
<td align="left">Burhinus oedicnemus</td>
<td align="left">Eurasian Thick-knee</td>
<td align="right">-33</td>
</tr>
<tr class="even">
<td align="left">Calandrella brachydactyla</td>
<td align="left">Greater Short-toed Lark</td>
<td align="right">49</td>
</tr>
<tr class="odd">
<td align="left">Carpodacus erythrinus</td>
<td align="left">Common Rosefinch</td>
<td align="right">-38</td>
</tr>
<tr class="even">
<td align="left">Cecropis daurica</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Ciconia ciconia</td>
<td align="left">White Stork</td>
<td align="right">57</td>
</tr>
<tr class="even">
<td align="left">Circus aeruginosus</td>
<td align="left">Western Marsh-harrier</td>
<td align="right">436</td>
</tr>
<tr class="odd">
<td align="left">Clamator glandarius</td>
<td align="left">Great Spotted Cuckoo</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">Columba palumbus</td>
<td align="left">Common Woodpigeon</td>
<td align="right">105</td>
</tr>
<tr class="odd">
<td align="left">Cuculus canorus</td>
<td align="left">Common Cuckoo</td>
<td align="right">-32</td>
</tr>
<tr class="even">
<td align="left">Cyanecula svecica</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Delichon urbicum</td>
<td align="left">Northern House Martin</td>
<td align="right">-22</td>
</tr>
<tr class="even">
<td align="left">Egretta garzetta</td>
<td align="left">Little Egret</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Emberiza hortulana</td>
<td align="left">Ortolan Bunting</td>
<td align="right">-90</td>
</tr>
<tr class="even">
<td align="left">Emberiza melanocephala</td>
<td align="left">Black-headed Bunting</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Falco tinnunculus</td>
<td align="left">Common Kestrel</td>
<td align="right">-24</td>
</tr>
<tr class="even">
<td align="left">Ficedula albicollis</td>
<td align="left">Collared Flycatcher</td>
<td align="right">141</td>
</tr>
<tr class="odd">
<td align="left">Ficedula hypoleuca</td>
<td align="left">European Pied Flycatcher</td>
<td align="right">-29</td>
</tr>
<tr class="even">
<td align="left">Fringilla montifringilla</td>
<td align="left">Brambling</td>
<td align="right">-48</td>
</tr>
<tr class="odd">
<td align="left">Gallinago gallinago</td>
<td align="left">Common Snipe</td>
<td align="right">-48</td>
</tr>
<tr class="even">
<td align="left">Grus grus</td>
<td align="left">Common Crane</td>
<td align="right">513</td>
</tr>
<tr class="odd">
<td align="left">Haematopus ostralegus</td>
<td align="left">Eurasian Oystercatcher</td>
<td align="right">-6</td>
</tr>
<tr class="even">
<td align="left">Hippolais icterina</td>
<td align="left">Icterine Warbler</td>
<td align="right">-49</td>
</tr>
<tr class="odd">
<td align="left">Hippolais polyglotta</td>
<td align="left">Melodious Warbler</td>
<td align="right">-29</td>
</tr>
<tr class="even">
<td align="left">Hirundo rustica</td>
<td align="left">Barn Swallow</td>
<td align="right">-9</td>
</tr>
<tr class="odd">
<td align="left">Iduna pallida</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">Jynx torquilla</td>
<td align="left">Eurasian Wryneck</td>
<td align="right">-64</td>
</tr>
<tr class="odd">
<td align="left">Lanius collurio</td>
<td align="left">Red-backed Shrike</td>
<td align="right">-18</td>
</tr>
<tr class="even">
<td align="left">Lanius minor</td>
<td align="left">Lesser Grey Shrike</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Lanius senator</td>
<td align="left">Woodchat Shrike</td>
<td align="right">-20</td>
</tr>
<tr class="even">
<td align="left">Larus ridibundus</td>
<td align="left">Black-headed Gull</td>
<td align="right">-48</td>
</tr>
<tr class="odd">
<td align="left">Limosa limosa</td>
<td align="left">Black-tailed Godwit</td>
<td align="right">-59</td>
</tr>
<tr class="even">
<td align="left">Locustella fluviatilis</td>
<td align="left">River Warbler</td>
<td align="right">-74</td>
</tr>
<tr class="odd">
<td align="left">Locustella naevia</td>
<td align="left">Common Grasshopper-warbler</td>
<td align="right">-73</td>
</tr>
<tr class="even">
<td align="left">Luscinia luscinia</td>
<td align="left">Thrush Nightingale</td>
<td align="right">-33</td>
</tr>
<tr class="odd">
<td align="left">Luscinia megarhynchos</td>
<td align="left">Common Nightingale</td>
<td align="right">-67</td>
</tr>
<tr class="even">
<td align="left">Merops apiaster</td>
<td align="left">European Bee-eater</td>
<td align="right">120</td>
</tr>
<tr class="odd">
<td align="left">Motacilla cinerea</td>
<td align="left">Grey Wagtail</td>
<td align="right">9</td>
</tr>
<tr class="even">
<td align="left">Motacilla flava</td>
<td align="left">Western Yellow Wagtail</td>
<td align="right">-76</td>
</tr>
<tr class="odd">
<td align="left">Muscicapa striata</td>
<td align="left">Spotted Flycatcher</td>
<td align="right">-50</td>
</tr>
<tr class="even">
<td align="left">Numenius arquata</td>
<td align="left">Eurasian Curlew</td>
<td align="right">-36</td>
</tr>
<tr class="odd">
<td align="left">Numenius phaeopus</td>
<td align="left">Whimbrel</td>
<td align="right">77</td>
</tr>
<tr class="even">
<td align="left">Oenanthe cypriaca</td>
<td align="left">Cyprus Wheatear</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Oenanthe hispanica</td>
<td align="left">Black-eared Wheatear</td>
<td align="right">-36</td>
</tr>
<tr class="even">
<td align="left">Oenanthe oenanthe</td>
<td align="left">Northern Wheatear</td>
<td align="right">-71</td>
</tr>
<tr class="odd">
<td align="left">Oriolus oriolus</td>
<td align="left">Eurasian Golden Oriole</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">Phoenicurus phoenicurus</td>
<td align="left">Common Redstart</td>
<td align="right">8</td>
</tr>
<tr class="odd">
<td align="left">Phylloscopus bonelli</td>
<td align="left">Western Bonelli’s Warbler</td>
<td align="right">-15</td>
</tr>
<tr class="even">
<td align="left">Phylloscopus collybita</td>
<td align="left">Common Chiffchaff</td>
<td align="right">119</td>
</tr>
<tr class="odd">
<td align="left">Phylloscopus sibilatrix</td>
<td align="left">Wood Warbler</td>
<td align="right">-44</td>
</tr>
<tr class="even">
<td align="left">Phylloscopus trochilus</td>
<td align="left">Willow Warbler</td>
<td align="right">-33</td>
</tr>
<tr class="odd">
<td align="left">Pluvialis apricaria</td>
<td align="left">Eurasian Golden Plover</td>
<td align="right">-13</td>
</tr>
<tr class="even">
<td align="left">Podiceps cristatus</td>
<td align="left">Great Crested Grebe</td>
<td align="right">5</td>
</tr>
<tr class="odd">
<td align="left">Saxicola rubetra</td>
<td align="left">Whinchat</td>
<td align="right">-88</td>
</tr>
<tr class="even">
<td align="left">Spinus spinus</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Streptopelia turtur</td>
<td align="left">European Turtle-dove</td>
<td align="right">-80</td>
</tr>
<tr class="even">
<td align="left">Sylvia borin</td>
<td align="left">Garden Warbler</td>
<td align="right">-28</td>
</tr>
<tr class="odd">
<td align="left">Sylvia cantillans</td>
<td align="left">Subalpine Warbler</td>
<td align="right">176</td>
</tr>
<tr class="even">
<td align="left">Sylvia communis</td>
<td align="left">Common Whitethroat</td>
<td align="right">23</td>
</tr>
<tr class="odd">
<td align="left">Sylvia curruca</td>
<td align="left">Lesser Whitethroat</td>
<td align="right">-16</td>
</tr>
<tr class="even">
<td align="left">Sylvia hortensis</td>
<td align="left">Western Orphean Warbler</td>
<td align="right">160</td>
</tr>
<tr class="odd">
<td align="left">Sylvia nisoria</td>
<td align="left">Barred Warbler</td>
<td align="right">-66</td>
</tr>
<tr class="even">
<td align="left">Tachybaptus ruficollis</td>
<td align="left">Little Grebe</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">Tadorna tadorna</td>
<td align="left">Common Shelduck</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">Tringa erythropus</td>
<td align="left">Spotted Redshank</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">Tringa glareola</td>
<td align="left">Wood Sandpiper</td>
<td align="right">-13</td>
</tr>
<tr class="even">
<td align="left">Tringa nebularia</td>
<td align="left">Common Greenshank</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">Tringa ochropus</td>
<td align="left">Green Sandpiper</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">Tringa totanus</td>
<td align="left">Common Redshank</td>
<td align="right">-54</td>
</tr>
<tr class="odd">
<td align="left">Turdus iliacus</td>
<td align="left">Redwing</td>
<td align="right">-16</td>
</tr>
<tr class="even">
<td align="left">Turdus pilaris</td>
<td align="left">Fieldfare</td>
<td align="right">18</td>
</tr>
<tr class="odd">
<td align="left">Turdus torquatus</td>
<td align="left">Ring Ouzel</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">Upupa epops</td>
<td align="left">Common Hoopoe</td>
<td align="right">244</td>
</tr>
<tr class="odd">
<td align="left">Vanellus vanellus</td>
<td align="left">Northern Lapwing</td>
<td align="right">-55</td>
</tr>
</tbody>
</table></div>
</div>
<p>A total of 85 is retained in this dataset.</p>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="gee-harmonic-regression.html"><span class="header-section-number">1</span> GEE: Harmonic Regression</a></div>
<div class="next"><a href="species-assemblage-trends.html"><span class="header-section-number">3</span> Species assemblage trends</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#preprocess-bird-trends-and-distribution-maps"><span class="header-section-number">2</span> Preprocess bird trends and distribution maps</a></li>
<li><a class="nav-link" href="#converting-the-esri-geodatabase"><span class="header-section-number">2.1</span> Converting the ESRI Geodatabase</a></li>
<li><a class="nav-link" href="#load-species-trends"><span class="header-section-number">2.2</span> Load species trends</a></li>
<li><a class="nav-link" href="#loading-species-traits"><span class="header-section-number">2.3</span> Loading species traits</a></li>
<li><a class="nav-link" href="#select-migratory-species"><span class="header-section-number">2.4</span> Select migratory species</a></li>
<li><a class="nav-link" href="#match-names-to-birdlife-taxonomy"><span class="header-section-number">2.5</span> Match names to BirdLife taxonomy</a></li>
<li><a class="nav-link" href="#querying-distribution-maps"><span class="header-section-number">2.6</span> Querying distribution maps</a></li>
<li><a class="nav-link" href="#species-included-in-the-analysis"><span class="header-section-number">2.7</span> Species included in the analysis</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/barthoekstra/envirpred/blob/master/02.Preprocess-bird-trends-distribution-maps.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/barthoekstra/envirpred/edit/master/02.Preprocess-bird-trends-distribution-maps.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Environmental predictability &amp; Population trends</strong>: Linking environmental predictability to assemblage population trends of Afro-Palearctic migrants" was written by Bart Hoekstra. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
